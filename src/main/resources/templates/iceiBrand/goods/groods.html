<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>店铺管理</title>
		<link href="../../layuiadmin/layui/css/layui.css" rel="stylesheet" media="all" />
		<link href=" ../../layuiadmin/style/table.css" rel="stylesheet" media="all" />
		<link href="../../layuiadmin/style/admin.css" rel="stylesheet" media="all">
		<link href="//at.alicdn.com/t/font_400842_q6tk84n9ywvu0udi.css" rel="stylesheet" />
		<link href="../../layuiadmin/style/iframe-child.css" rel="stylesheet" />
		<style>
#jiaid{
	display: none;
}
 #popups{
	width:800px;
	height:100%;
	display:none;
	overflow: hidden;
}
#popups ul {
	width:400px;
	float:left;
	margin-top:30px;
	margin-left:200px;
}
#popups ul li{
	width:400px;
	height:60px;
	line-height: 60px;
}
#popups ul li input{
width:250px;}
#popups ul li span{
	display: block;
	width:120px;
	float:left;
	text-align: center;
	margin-left:20px;
	
}
.li_center{
	width:200px;
	height:100%;
	margin:0 auto;
	text-align: center;
}
.layui-input{
	width:186px;
}
.left_inline{
margin-left: -3px;}
.popright{
width:380px;
float:right;
}
#disc_ul {
margin-top:10px;

}
#disc_ul p{
	width:320px;
	height:35px;
	line-height: 35px;
	text-align: center;
	padding-left:60px;
}
#disc_ul p ems{
	width:100px;
	height:35px;
	display: block;
	text-align: center;
	float:left;
}
#search_bth{
	width:140px;
	text-align: center;
	font-size:17px;
	margin-top:50px;
	margin-left:40px;
}
.postion_abst{
	position: absolute;
	bottom: 16px;
	left: 297px;
	width: 250px;
}
#disc_msg{
	width: 400px;
	height: 100px;
}
#disc_qued{
	width: 100px;
	height: 52px;
	position: absolute;
	left: 83px;
	top: 305px;
}
#disc_qued1{
	width: 100px;
	height: 52px;
	position: absolute;
	left: 83px;
	top: 235px;
}
#goods_dec{
	width: 258px;
	margin-left: 19px;
}

.dis_ul input{
	width:258px;
}
		</style>
	</head>

	<body>
		<div class="layui-fluid">
			<div class="layui-row layui-col-space15">
				<div class="layui-col-md15 main-container">
					<div class="layui-card">
						<div class="layui-card-header">
							商品管理
						</div>
						<div class="layui-card-body">
							<div class="layui-form-item" style="border-bottom: 1px solid #f6f6f6;">
								<div class="layui-input-block">
									<div class="layui-inline">
										<input id="input_id"  type="text" name="keyword" style="width: 240px;display: inline;" required lay-verify="required" placeholder="请输入商品编号" autocomplete="off" class="layui-input" />
									</div>
									<div class="layui-inline">
										<form class="layui-form" style="width: 200px;display: inline;">
											<select name="type" lay-filter="test1" id="select_one">
												<option value="">请选择商品类型</option>
											</select>
										</form>
									</div>
									<div class="layui-inline">
										<form class="layui-form" style="width: 200px;display: inline;">
											<select name="type" id="select_two">
												<option value="">请选择详细类型</option>
											</select>
										</form>
									</div>
									<div class="layui-inline">
										<a id="search" class="layui-btn">搜索</a>
									</div>
								</div>
							</div>
							<table id="table" lay-filter="Audit" lay-data="{id: 'goodsId'}">

							</table>
							
							<div id="popups">
							<!-- <div class="li_center"><button  class="layui-btn addsetting">新增</button><input id="jiaid" type="text" value="1" /><button class="layui-btn">重置</button></div> -->
								<ul class="dis_ul">
									<li>
										<span>商品类型</span>
											<div class="layui-inline">
										<form class="layui-form" style="width: 200px;display: inline;">
											<select name="type" class="brand_id"  lay-filter="test" id="select_ones">
												<option value="">请选择商品类型</option>
												
											</select>
										</form>
									</div>
									</li>
									<li>
										<span>详细类型</span>
										<div class="layui-inline">
										<form class="layui-form" style="width: 200px;display: inline;">
											<select name="type" class="type_detail_id" id="select_twos">
												<option value="">请选择商品类型</option>
												
											</select>
										</form>
									</div>
									</li>
									<li>
										<span>商品名称：</span>
										<div class="layui-input-inline">
	       									 <input id="goods_name" name="phone" class="generalize_money layui-input" lay-verify="required|phone" autocomplete="off"  type="tel">
	      								</div>
      								</li>
									<li><span>基础价格：</span>
									<div class="layui-input-inline">
	       									 <input id="goods_price" name="phone" class="generalize_commission layui-input" lay-verify="required|phone" autocomplete="off"  type="tel">
	      								</div>
      								</li>
									<li><span>商品折扣：</span>
										<div class="layui-input-inline">
	       									 <input id="goods_discount" type="text" class="layui-input" >
	      								</div>
      								</li>
      								<li><span>材质：</span>
										<div class="layui-input-inline">
	       									 <input id="materials" type="text" class="layui-input" >
	      								</div>
      								</li>
									<li><span>是否定制：</span>
										<div class="layui-inline">
										<form class="layui-form" style="width: 200px;display: inline;">
											<select name="type" disabled="disabled" onchange="is_diy_pop();" id="is_diy">
												<option value="1">否</option>
												<option value="0">是</option>
											</select>
										</form>
									</div>
      								</li>
      								<li><span>定制收费：</span>
										<div class="layui-input-inline">
	       									 <input id="diy_price" type="text" readonly="false" value="0" class="layui-input" >
	       								 </div>
      								</li>
      								<li><span>生产周期：</span>
										<div class="layui-input-inline">
	       									 <input id="production_cycle" type="text" readonly="true" value="0" class="layui-input" >
	       								 </div>
      								</li>
      								<li>
      									<div id="disc_msg">
											<span>商品描述：</span>
											<div style="margin-left: -20px;" class="layui-input-inline">
											 		<textarea name="desc" id="goods_dec" placeholder="请输入内容" class="layui-textarea"></textarea>
			       									
			       							</div>
										</div>
      								</li>
								</ul>
								<div id="disc_qued1">
									<div class="layui-inline">
										<a id="Msg_show" class="layui-btn">查看详细</a>
									</div>
								</div>
								<div id="disc_qued">
									<div class="layui-inline">
										<a id="updatese" class="layui-btn">修改</a>
									</div>
								</div>
								
								
								<ul id="disc_ul">
									<li>
										<span>商品编号：</span>
										<div class="layui-input-inline">
	       									 <input id="goods_id" type="text" readonly="true" value="" class="layui-input" >
	       								 </div>
	       							</li>
									<li><span>销量</span>
										<div class="layui-input-inline">
	       									 <input id="sales_volume" type="text" readonly="true" value="0" class="layui-input" >
	       								 </div>
      								</li>
      								<li><span>商品评价</span>
										<div class="layui-input-inline">
	       									 <input id="goods_quality" type="text" readonly="true" value="0" class="layui-input" >
	       								 </div>
      								</li>
      								<li><span>服务评价</span>
										<div class="layui-input-inline">
	       									 <input id="server_attitude" type="text" readonly="true" value="0" class="layui-input" >
	       								 </div>
      								</li>
      								<li><span>商品满意度</span>
										<div class="layui-input-inline">
	       									 <input id="assess_count_love" type="text" readonly="true" value="0" class="layui-input" >
	       								 </div>
      								</li>
      								<li><span>评价总人数</span>
										<div class="layui-input-inline">
	       									 <input id="like_count" type="text" readonly="true" value="0" class="layui-input" >
	       								 </div>
      								</li>
      								<li><span>收藏总数</span>
										<div class="layui-input-inline">
	       									 <input id="like_count" type="text" readonly="true" value="0" class="layui-input" >
	       								 </div>
      								</li>
      								
      								
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="../../layuiadmin/layui/layui.js"></script>
	<script src="../../layuiadmin/jquery/jquery-3.3.1.min.js"></script>
	<script type="text/html" id="barDemo">
		<a class="layui-btn layui-btn-xs" onclick="tabshow(1)"  lay-event="1">查看</a>
		<a class="layui-btn layui-btn-xs" onclick="tabshow(2)"  lay-event="2">编辑</a>
		<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="3" >下架</a>
	</script>
	<script>
	var table;
	var tableinsr;
	var form;
		$(document).ready(function() {
			$("#disc_ul").hide();
			//绑定商品类型下拉框
			TiedownOne("#select_one");
			TiedownOne("#select_ones");
			layui.use(['table','form'], function() {
				table = layui.table,
				form=layui.form;
				tableinsr=table.render({
					elem: '#table',
					url: "/brand/message",
					where:{
							limit:5,
							typeDetailId:0,
							goodsId:0
					},	
					cellMinWidth: 80,
					limit:5,
					cols: [
						[{
								type: 'checkbox'
							},{
								title: "商品编号",
								field:"goodsId",
							}, {
								title: "商品图片",
								templet: '<div><img src="http://spoons.test.upcdn.net{{d.goodsImg}}" width="60px" height="60px" /></div>',
							}, {
								title: "名称",
								field:"goodsName",
								width:200,
							}, {
								title: "具体类型",
								templet: "<div>{{d.goodsTypeDetail.typeDetailName}}</div>",
								width:150,
							}, {
								field: 'goodsPrice',
								title: "基础价格",
							}, {
								templet: '<div>{{d.isDiy==0?"是":"否"}}</div>',
								title: "是否定制",
							}, {
								field: "goodsDiscount",
								title: "商品折扣"
							}, {
								field: "materials",
								title: "商品材质"
							}, {
								field: "salesVolume",
								title: "销量"
							}, {
								templet: "#barDemo",
								title: "操作",
								width:191,
							}
						]
					],
					page: true,
					done: function() {
						$(".table-shop-name").click(function() {
							iframeWindow(this);
						});
					}
				});
			  
				//监听点击的按钮
				table.on('tool(Audit)', function(obj){
					var layEvent = obj.event;
					var data = obj.data;
					var tr = obj.tr;
					if(obj.event === '1'){
						var d=data;
						console.log(d)
						update_pop(d)
					}
					if(obj.event === '2'){
						var d=data;
						console.log(d)
						update_pop(d)
					}
					if(obj.event === '3'){
						layer.confirm('确认删除吗？',function(){
							delByid(data.goodsId,obj);
						});
					}
				});
				
				//二级联动
				form.on('select(test)', function(data){
					  console.log(data.value); //得到被选中的值
					  $("#select_twos").find(" option:eq(0)").nextAll().remove();
					  selectTwoMsg(data.value,2);
				});
				//二级联动
				form.on('select(test1)', function(data){
					  console.log(data.value); //得到被选中的值
					  $("#select_two").find(" option:eq(0)").nextAll().remove();
					  selectTwoMsg(data.value,1);
				});
			});
		});
		//修改数据
		$("#updatese").click(function(){
			var brand_id=$("#select_ones").val();//品牌id
			var type_detail_id=$("#select_twos").val();//具体类型idid
			var goods_name=$("#goods_name").val();//名称
			var goods_price=$("#goods_price").val();//基础价格
			var goods_discount=$("#goods_discount").val();//商品折扣
			var diy_price=$("#diy_price").val();//定制收费
			var is_diy=$("#is_diy").val();//是否定制
			var production_cycle=$("#production_cycle").val();//生产周期
			var goods_dec=$("#goods_dec").val();//产品描述
			var materials=$("#materials").val();//材质
			var goods_id=$("#goods_id").val();
			$.post("/brand/updateByKey",{"typeDetailId":type_detail_id,"goodsName":goods_name,"goodsPrice":goods_price,"goodsDiscount":goods_discount,
				"diyPrice":diy_price,"isDiy":is_diy,"productionCycle":production_cycle,"goodsDec":goods_dec,"materials":materials,"goodsId":goods_id},function(d){
				if(d.data==1){
					layer.msg("成功")
					window.location.reload();
				}else{
					layer.msg("失败")
				}
			})
			
		})
		
		$("#Msg_show").click(function(){
			if($("#Msg_show").text()=='返回'){
				$(".dis_ul").show(500);
				$("#disc_ul").hide(500);
				$("#Msg_show").text('查看详情');
				return;
			}
			$("#Msg_show").text('返回');
			$(".dis_ul").hide(500);
			$("#disc_ul").show(500);
		})
		//会先数据
		function update_pop(d){
			$("#select_ones").val(d.goodsType.typeId);//具体类型idid
			selectTwoMsg(d.goodsType.typeId,2,d.goodsTypeDetail.typeDetailId)
			$("#goods_name").val(d.goodsName);//名称
			$("#goods_price").val(d.goodsPrice);//基础价格
			$("#goods_discount").val(d.goodsDiscount);//商品折扣
			$("#diy_price").val(d.diyPrice);//定制收费
			$("#is_diy").val(d.isDiy);//是否定制
			$("#production_cycle").val(d.productionCycle);//生产周期
			$("#goods_dec").val(d.goodsDec);//产品描述
			$("#materials").val(d.materials);//材质
			$("#sales_volume").val(d.salesVolume);//销量
			$("#goods_quality").val(d.goodsQuality);//商品评价
			$("#server_attitude").val(d.serverAttitude);//服务评价
			$("#assess_count_love").val(d.assessCountLove);//商品满意度
			$("#assess_count").val(d.assessCount);//评价总人数
			$("#like_count").val(d.likeCount);//带收藏中人数
			$("#goods_id").val(d.goodsId);
			is_diy_pop()
		}
		//添加数据
		$("#insert_bth").click(function(){
				var brand_id=$("#select_ones").val();//品牌id
				var type_detail_id=$("#select_twos").val();//具体类型idid
				var goods_name=$("#goods_name").val();//名称
				var goods_price=$("#goods_price").val();//基础价格
				var goods_discount=$("#goods_discount").val();//商品折扣
				var diy_price=$("#diy_price").val();//定制收费
				var is_diy=$("#is_diy").val();//是否定制
				var production_cycle=$("#production_cycle").val();//生产周期
				var goods_dec=$("#goods_dec").val();//产品描述
				var materials=$("#materials").val();//材质
				var sales_volume=$("#sales_volume").val();//销量
				var goods_quality=$("#goods_quality").val();//商品评价
				var server_attitude=$("#server_attitude").val();//服务评价
				var assess_count_love=$("#assess_count_love").val();//商品满意度
				var assess_count=$("#assess_count").val();//评价总人数
				var like_count=$("#like_count").val();//带收藏中人数
				console.log("品牌id"+brand_id);
				console.log("具体类型id"+type_detail_id);
				console.log("名称"+goods_name);
				console.log("基础价格"+goods_price);
				console.log("商品折扣"+goods_discount);
				console.log("是否定制"+is_diy);
				console.log("定制收费"+diy_price);
				console.log("产品描述"+goods_dec);
				console.log("材质"+materials);
				console.log("销量"+sales_volume);
				console.log("商品评价"+goods_quality);
				console.log("服务评价"+server_attitude);
				console.log("评价总人数"+assess_count);
				console.log("收藏中人数"+like_count);
				$.post("/brand/insertByKey",{"brandId":1,"typeDetailId":type_detail_id,"goodsName":goods_name,"goodsPrice":goods_price,"goodsDiscount":goods_discount,"isDiy":is_diy,
					"diyPrice":diy_price,"goodsDec":goods_dec,"materials":materials,"salesVolume":sales_volume,"goodsQuality":goods_quality,"serverAttitude":server_attitude,"assessCount":assess_count,
					"likeCount":like_count,"assessCountLove":assess_count_love,"productionCycle":production_cycle},function(data){
						console.log(data);
				})
		}); 
		
		//是否定制相关显示
		function is_diy_pop(){
			console.log('123');
			var val=$("#is_diy").val();
			if(val==1){
				//否
				$("#diy_price").attr("readonly","true");
				$("#diy_price").val(0);
				$("#production_cycle").attr("readonly","true");
				$("#production_cycle").val(0);
				console.log("0")
			}
			if(val==0){
				//是
				$("#diy_price").removeAttr("readonly");
				$("#production_cycle").removeAttr("readonly")
				console.log("1")
			}
		}
		//绑定下拉框
		function selectTwoMsg(id,num,di){
			$.get("/brand/getAllTypeDetailNameByid",{"id":id},function(data){
				if(data!=''){
					if(num==2){
						$("#select_twos option").remove();//具体类型id
					}
					$.each(data,function(v,val){
						var tr='<option value="'+val.typeDetailId+'">'+val.typeDetailName+'</option>';
						if(num==1){
							$("#select_two").append(tr);
						}if(num==2){
							$("#select_twos").append(tr);
						}
					})
					if(num==2){
						$("#select_twos").val(di);//具体类型id
					}
					form.render('select');
				}
			});
		}
		//下拉框
		function TiedownOne(o){
			$.get("/brand/getAllGoodsTypeName",function(data){
				$.each(data,function(v,val){
					var tr='<option value="'+val.typeId+'">'+val.typeName+'</option>';
					$(""+o+"").append(tr);
				})
				form.render('select');
			})
		}
		//下拉框
		function TiedownTwo(o){
			$.get("/brand/getAllTypeDetailName",function(data){
				$.each(data,function(v,val){
					var tr='<option value="'+val.typeDetailId+'">'+val.typeDetailName+'</option>';
					$(""+o+"").append(tr);
				})
			})
		}
		//删除数据
		function delByid(id,obj){
			$.post("/brand/delByIdbrandgoodsid",{"id":id},function(d){
				console.log(d)
				if(d.data==1){
					obj.del();//删除当前点击行
					layer.msg('删除成功！');
				}else{
					layer.msg('删除失败！');
				}
			})
		}
		
		
		
		//搜索  刷新数据
		$("#search").click(function(data){
			var typeid=$("#select_two").val();
			var goodsid=$("#input_id").val();
			if(typeid==''){
				typeid=0;
			}
			if(goodsid==''){
				goodsid=0;
			}
			tableinsr.reload({
				  where: {//参数
					  typeDetailId:typeid,
					  goodsId:goodsid
				  }
				  ,page: {
				    curr: 1 //重新从第 1 页开始
				  }
			});
		})
		
		/*商品弹出窗*/
		function tabshow(o) {
			if(o=='1'){
				$("#updatese").hide();
			}else{
				$("#updatese").show();
			}
			//自定页
			layer.open({
			  type: 1,
			  title :'新增商品',
			  skin: 'layui-layer-demo', //样式类名
			  closeBtn: 0, //不显示关闭按钮
			  anim: 2,
			  scrollbr:true,
			  area: ['800px', '743px'],
			  scrollbar: false,
			  shadeClose: false,
			  closeBtn :1, //开启遮罩关闭
			  content:$("#popups")
			});
		}
	</script>
	<script type="text/html" id="sta">
		<input brandid="{{d.brandId}}" type="checkbox" name="status" lay-skin="switch" lay-text="正常|封禁" lay-filter="status" {{d.brandStatus==0?"checked":""}} />
	</script>
</html>